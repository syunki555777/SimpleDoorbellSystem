# 📊 進捗管理システム

## 概要

このプロジェクトは、**Flask**を使用して構築された **進捗管理システム** です。班ごとにタスクの進捗を管理し、必要に応じて特定の班を呼び出す機能を提供します。また、管理者向けの管理機能や外部APIを通じた操作もサポートしています。

---

## 主な機能
以下のような機能を提供します。

- **班ごとのタスク管理**
    - 各班の現在の進捗状況を確認可能。
    - タスク完了操作や取り消しが可能。
    - 次に進めるべきタスクを表示。

- **呼び出し機能**
    - 班ごとに「呼び出し理由」を指定してリクエストを作成。
    - 管理者がリクエストを確認し、処理が完了したら削除する機能。

- **管理者向け機能**
    - 全班の進捗状況や呼び出しリクエストを一括管理。
    - 各班の進捗状況を更新またはリセット可能。

- **外部APIサポート**
    - 外部システムから進捗や呼び出しリクエストを操作可能なAPIを提供。

## 使用方法

### 1. 必要な環境構築
以下を事前にインストールしてください。

- **Python 3.12**
- 必須ライブラリ（Flask 等）
  ```bash
  pip install Flask
  ```

### 2. 実行方法

アプリケーションを実行するには、以下のコマンドを使用します。

```bash
python app.py
```

デフォルトでは、アプリケーションはローカルホスト (`http://127.0.0.1:5000`) で動作します。

---

## 主なルートと機能

### ユーザー向け
- `/` : トップページ。班のタスクと進捗状況を表示します。
- `/group/<group_id>` : 指定された班の進捗を表示・操作するページ。
- `/confirm/<group_id>/<task>` : タスク完了操作の確認ページ。
- `/confirm_call/<group_id>/<reason>` : 呼び出しリクエスト確認ページ。

### APIエンドポイント
- `/api/call/<group_id>/<reason>` : 任意の班を呼び出すAPI (`POST` リクエスト)。
- `/api/task/<group_id>` : 次のタスクを完了状態に更新するAPI (`POST` リクエスト)。
- `/api/task/<group_id>/undo` : 最後に完了したタスクを取り消すAPI (`POST` リクエスト)。

### 管理者向け
- `/admin` : 管理者専用インターフェース。全班の進捗状況と呼び出しリクエストを管理。
- `/update_progress` : 管理者がタスクのステータスを更新するエンドポイント。
- `/clear_progress/<group_id>` : 指定された班の進捗をリセットするエンドポイント。
- `/get_progress` : 全班の進捗状況をJSON形式で取得するAPI。
- `/get_call_requests` : 全ての呼び出しリクエストをJSON形式で取得するAPI。
- `/complete_call_request` : 指定された呼び出しリクエストを処理完了として削除。

---

## カスタマイズのポイント

以下の定数を適宜変更してください。

- **トークン設定**
  - `SECRET_TOKEN`: 管理者専用のトークン。
  - `STUDENT_TOKEN`: 班の進捗管理画面用のトークン。
  - `REMOTE_TOKEN`: 外部API用のトークン。

- **タスクと班設定**
  - `NUMBER_OF_GROUPS`: 班の総数 (例: 14)。
  - `TASKS`: 管理するタスク一覧 (例: `["課題1", "課題2"]`)。
  - `CALL_REASONS`: 呼び出しで使用可能な理由リスト。

---

## セキュリティ

- 各エンドポイントはトークンを使用して認証しています。適切に変更・管理してください。
- トークン値は**公開しないでください**。

---
### 注意事項
- インメモリデータベースを使用しています。途中で動作を停止すると、呼び出し内容が消えますのでご注意ください。
- 汎用性の観点から、呼び出し理由について厳格なチェックをしていません。POST内容の文言がそのまま掲載されます。
- 班番号は班の総数によらず無制限に作成することができます。
## PDF生成機能

### 機能概要
班ごとのQRコードを生成し、それらをPDFファイルとして出力する機能を提供しています。生成されるPDFには、以下の内容が含まれます。

- 各班のQRコード
- 対応するURL
- 班の番号
- QRコード下に補助説明画像

### 必要な環境構築
PDF生成に必要な以下のライブラリをインストールしてください。

```bash
pip install reportlab qrcode
```

また、`MPLUSRounded1c-ExtraBold.ttf` フォントおよび補助説明画像（例: `introduction.png`）を適切なディレクトリに配置してください。詳細なディレクトリ構成は以下を参照してください。

### 設定方法
`config.py` に以下の設定を記載する必要があります。

- `NUMBER_OF_GROUPS`: 班の総数を設定（例: `5`）。
- `SERVER_URL`: QRコードのベースとなるURL（例: `http://example.com`）。
- `STUDENT_TOKEN`: QRコードに含めるトークン情報（例: `your_token_here`）。

```python
# config.py サンプル
NUMBER_OF_GROUPS = 5
SERVER_URL = "http://example.com"
STUDENT_TOKEN = "your_token_here"
```

### 実行方法
以下のコマンドを実行することでPDFを生成できます。

```bash
python generatePDF.py
```

### 出力内容
実行後、PDFファイルが `pdf/pdf_output/班別QRコード一覧.pdf` に生成されます。

各ページには以下の内容が含まれます。
1. ページ上部に班番号タイトル（例: 「班 1 のQRコード」）。
2. ページ中央にQRコード。
3. QRコード下に該当URL。
4. ページ最下部に補助説明画像（例: `introduction.png`）。

### エラー時のチェックポイント
- 必須ファイル（`MPLUSRounded1c-ExtraBold.ttf`、`introduction.png`）が正しいディレクトリに配置されているか確認してください。
- 必要ライブラリ (`reportlab`, `qrcode`) が正しくインストールされているか確認してください。

---

# セットアップについて
### 自動設定スクリプト (`setup.py`)
#### 機能概要
`setup.py` は、プロジェクトで必要な設定値を簡単に生成し、`config.py` に保存するための対話型スクリプトです。トークンや班数、タスクなどの設定を簡単に構成できます。
#### 主な機能
1. **ランダムなトークンの生成**:
    - 管理者用トークンや外部API用トークンなど、ランダムな英数字トークンを自動生成します。
    - 手動入力も可能です。

2. **班数、タスク、呼び出し理由の設定**:
    - 任意の班の総数や管理するタスク名、呼び出し理由を対話形式で指定できます。

3. **サーバーURLの設定**:
    - アプリケーションが動作するサーバーのURLを指定します。

4. **対話的インターフェース**:
    - 各質問に答える形式で設定を簡単に構成できます。

5. **設定ファイル (`config.py`) の生成**:
    - 指定した内容をPythonファイル形式で保存します。

#### 実行方法
以下のコマンドでスクリプトを実行します。
``` bash
python setup.py
```
#### 実行フロー
1. ターミナルで対話形式の質問が表示されます。
2. 質問に答えると、設定がリアルタイムで構成されます。
3. 設定内容は `config.py` に保存されます
